# site.yml
---
- hosts: all
  name: "Update all packages"
  become: yes
  tasks:
  - apt:
      upgrade: safe

- hosts: all
  vars_files:
    - files/vars.yml
    - files/env.yml
  become: yes
  become_user: root
  tasks:
  - name: Install required system packages.
    apt: pkg={{ item }} state=latest
    with_items: "{{ system_packages }}"

  - name: Install  python packages
    pip: name={{ item }}
    with_items: "{{ python_packages }}"

- hosts: all
  become: yes
  tasks:
  - name: Add PPA to nginx
    apt_repository:
      repo: 'ppa:nginx/stable'
  - name: Install nginx stable
    apt: pkg=nginx state=latest


- hosts: all
  become: yes
  vars_files:
    - files/vars.yml
    - files/env.yml
  tasks:
    - name: Configure repository
      shell: curl -sL https://deb.nodesource.com/setup_7.x | sudo -E bash -
    - name: Install node 7
      apt: pkg=nodejs state=latest
  roles:
    - role: greendayonfire.mongodb

- hosts: all
  become: yes
  tasks:
  - name: "Install forever (to run Node.js app)."
    npm: name=forever global=yes state=latest

  - name: Install Bower and Grunt
    npm: name={{ item }} state=latest global=yes
    with_items:
    - bower
    - grunt
    - grunt-cli

- hosts: all
  become: yes
  roles:
    - {
        role: rvm_io.ruby,
        tags: ruby,
        rvm1_rubies: ['ruby-2.3.3'],
        rvm1_user: 'ratox'
      }
