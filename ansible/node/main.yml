#VERSION: 0.0.1
#refs: https://github.com/William-Yeh/ansible-nodejs

---
- hosts: all
  user: ratox
  become: True
  vars:
    nodejs_version: "4.4.5"
    nodejs_compile: True
  tasks:
  - name: install add-apt-repository and https binaries for Ansible to work
    apt: name={{ item }} state=present update_cache=yes
    with_items:
      - python-software-properties
      - apt-transport-https

  - name: install tools for compiling native addons from npm
    apt: name={{ item }} state=present
    with_items:
      - build-essential
    when: nodejs_compile

  - name: add NodeSource key
    apt_key: data="{{ lookup('file', 'nodesource.gpg.key') }}" state=present

  - block:
    - name: add NodeSource repository for Node.js 4
      apt_repository: repo='{{ item }} https://deb.nodesource.com/node_4.x {{ ansible_distribution_release|lower }} main' state=present
      with_items:
        - deb
        - deb-src
    - name: install Node.js with specific version
      apt: name="nodejs={{ nodejs_version }}*"  update_cache=yes  state=present force=yes
